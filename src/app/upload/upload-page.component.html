<div class="upload-page">
  <h1 class="title">Add a new wardrobe item</h1>

  <p class="subtitle">
    Capture or upload a photo of a single clothing item. We'll prepare it for
    your digital closet.
  </p>

  <!-- Mode toggle: Camera vs File upload -->
  <div class="mode-toggle">
    <button
      type="button"
      class="mode-btn"
      [class.mode-btn--active]="mode === 'camera'"
      (click)="switchMode('camera')"
    >
      Camera
    </button>
    <button
      type="button"
      class="mode-btn"
      [class.mode-btn--active]="mode === 'file'"
      (click)="switchMode('file')"
    >
      Upload from files
    </button>
  </div>

  <!-- CAMERA MODE -->
  @if (mode === 'camera') {
    <section class="panel">
      <h2 class="panel-title">Use your camera</h2>
      <p class="panel-text">
        Place the item on a plain background, fill the frame, and avoid harsh
        shadows.
      </p>

      <app-camera-capture (photoCaptured)="onPhotoCaptured($event)">
      </app-camera-capture>
    </section>
  }

  <!-- FILE MODE -->
  @if (mode === 'file') {
    <section class="panel">
      <h2 class="panel-title">Upload a photo</h2>
      <p class="panel-text">
        Choose an existing photo from your gallery. Ideally, the item should be
        centered and clearly visible.
      </p>

      <label class="file-input-label">
        <input
          type="file"
          accept="image/*"
          (change)="onFileSelected($event)"
          class="file-input"
        />
        <span>Choose image</span>
      </label>
    </section>
  }

  <!-- PIPELINE STATUS & PREVIEWS -->
  @if (rawPreviewUrl || processedPreviewUrl) {
    <section class="pipeline">
      <h2 class="panel-title">Processing preview</h2>

      <div class="preview-row">
        <div class="preview-card">
          <h3>Original photo</h3>
          @if (rawPreviewUrl) {
            <div class="preview-frame">
              <img [src]="rawPreviewUrl" alt="Original preview" />
            </div>
          } @else {
            <div class="preview-placeholder">No image yet</div>
          }
        </div>

        <div class="preview-card">
          <h3>After background removal</h3>
          @if (processedPreviewUrl) {
            <div class="preview-frame">
              <img [src]="processedPreviewUrl" alt="Processed preview" />
            </div>
          } @else {
            <div class="preview-placeholder">
              Waiting for background removal...
            </div>
          }
        </div>
      </div>
    </section>
  }

  <!-- STATUS MESSAGE -->
  @if (statusMessage) {
    <p class="status">
      {{ statusMessage }}
    </p>
  }

  <!-- AI TAGGING RESULT -->
  @if (aiResult) {
    <section class="ai-result">
      <h2 class="panel-title">AI stylist tags</h2>
      <div class="tag-grid">
        <div class="tag-item"><strong>Item name:</strong> {{ aiResult.tags.item_name || 'N/A' }}</div>
        <div class="tag-item"><strong>Broad category:</strong> {{ aiResult.tags.broad_category || 'N/A' }}</div>
        <div class="tag-item"><strong>Sub-category:</strong> {{ aiResult.tags.sub_category || 'N/A' }}</div>
        <div class="tag-item"><strong>Silhouette:</strong> {{ aiResult.tags.silhouette || 'N/A' }}</div>
        <div class="tag-item"><strong>Materials:</strong> {{ aiResult.tags.materials || 'N/A' }}</div>
        <div class="tag-item"><strong>Colors:</strong> {{ aiResult.tags.colors?.join(', ') || 'N/A' }}</div>
        <div class="tag-item"><strong>Patterns:</strong> {{ aiResult.tags.patterns || 'N/A' }}</div>
        <div class="tag-item"><strong>Construction:</strong> {{ aiResult.tags.construction_details || 'N/A' }}</div>
        <div class="tag-item"><strong>Style vibe:</strong> {{ aiResult.tags.style_vibe || 'N/A' }}</div>
        <div class="tag-item"><strong>Best pairings:</strong> {{ aiResult.tags.best_pairings?.join(', ') || 'N/A' }}</div>
        <div class="tag-item"><strong>Seasonality:</strong> {{ aiResult.tags.seasonality?.join(', ') || 'N/A' }}</div>
        <div class="tag-item"><strong>Tags:</strong> {{ aiResult.tags.tags?.join(', ') || 'N/A' }}</div>
      </div>

      <div class="note">
        <p><strong>Image saved:</strong> {{ aiResult.imageUrl }}</p>
        <p>This data comes from the backend vision tagging endpoint (standard prompt + GPT-4o). Use it to pre-fill the Item Catalogue.</p>
      </div>
    </section>
  }
</div>
